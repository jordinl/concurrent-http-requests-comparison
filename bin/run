#!/usr/bin/env bash

set -u

target=$1

docker compose build "$target" --quiet

command="cat data/urls.txt | head -n ${LIMIT:-10000000} | docker compose run --rm -T $target"

if [[ "${FORMAT:-}" != "plain" ]]; then
  command+=" | node scripts/process-output.js"
fi

eval "$command"
