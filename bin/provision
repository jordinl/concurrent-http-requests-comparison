#!/usr/bin/env sh

credentials=$1

ssh -T -o StrictHostKeyChecking=no "$credentials" << EOF
    curl -fsSL https://get.docker.com | bash
    sudo usermod -aG docker \${USER}

    sudo apt install 7zip -y

    echo 'UV_THREADPOOL_SIZE=20' >> ~/.bashrc

    mkdir app
    cd app

    git config --global init.defaultBranch main
    git config --global receive.denyCurrentBranch updateInstead
    git init
EOF

git remote remove server
git remote add server "$credentials:app"

./bin/deploy

bin/ssh "bin/fetch-urls"
